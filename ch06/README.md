#Chapter.06 Node.js에서의 파일시스템 접근

### 동기적 파일 시스템 호출 vs 비동기적 파일일시스템 호출
#####동기적 호출이란?
>동기적 호출은 호출의 끝날때까지 블록 상태를 유지한 후 스레드로 제어가 넘어온다. 
다만, 메인 이벤트 스레드를 블록하거나 너무 많은 백그라운드 스레드를 실행할 경우, 성능의 저하를 가져올 수 있다. 이러하는 이유로 동기적 호출은 node.js에는 적합하지가 않다.

#####비동기적 호출이란?
>비동기적 호출은 이벤튜 큐에 추가된 후에 실행이 된다. 이방식은 Node.js의 이벤트 모델에 적합한 방식이다.

##### 그럼 둘의 차이점은?
>동기적, 비동기적 파일 시스템 호출의 내부의 기능은 동일하다. 둘 다 같은 전달인자를 사용하데는 비동기적 호출의 경우 마지막 전달인자로 파일 시스템 호출의 완료 후 수행 될 때 콜백 함수를 지정하는 부분에서 다르다.

---
###파일 열기 및 닫기
>>Node.js는 파일을 열기위한 동기적 비동기적 함수를 둘다 제공한다. 한 번 열린후에는 파일을 열 때 사용했던 플래그 값에 맞춰 데이트를 읽고 쓸 수 있다. 
```sh
fs.open(path, flags, [mode], callback);
fs.openSync(path, flags, [mode]);
```
#####flags 전달 인자값은 파일을 열기 위한 모드의 옵션을 지정할 수 있다.
- r : 읽기 가능 파일 열기. 파일이 존재하지 않을 경우 예외가 발생
- r+ : 읽기 쓰기 가능 파일 열기. 파일이 존재하지 않을 경우 예외가 발생
- rs : 동기화 모드로 읽기 가능 파일 열기. fs.openSync()와는 동일하지 않다. 사용시 로컬 파일 시스템 캐시를 통과한다. NFS 마운트 경우 오래된 로컬 캐시가 존재하지 않도록 만들기 때문에 유용. 시스템 성능 저하를 가져올 수 있기 때문에 플래그 사용에 각별한 주의가 요망.
- w : 쓰기 가능 한 파일 열기. 파일이 존재하지 않는 경우 새로 생성하고, 존재하는 경우 기존 내용 제거 후 내용 덮어쓰기
- wx : 기존 경로가 존재할 경우 실패를 제외한 나머지 기능은 'w' 옵션과 동일하다.
- w+ : 읽기 쓰기 가능 파일 열기. 파일이 존재하지 않을 경우, 파일 생성하고. 존재하는 경우 기존 내용 제거 후 내용 덮어쓴다.
- wx+ : 기존 경로가 존재할 경우 실패하는것을 제외한 나머지의 경우는 w+와 동일.
- a : 추가를 위한 파일 열기. 파일이 존재하지않을 경우 파일 생성.
- ax : 기존 경로가 존재할 경우에 실패. 그외에는 w와 동일.
- a+ : 읽기.추가를 위한 파일 열기. 파일이 존재하지 않으면 파일을 새로 생성.
- ax+ : 경로가 존재하는 경우에 실패. 그외에는 a+와 동일.

파일을 연 경우, 디스크에 변경 내역을 강제적으로 비우고, 운영체제의 파일 락을 해제하기 위해 파일을 닫는다. 파일을 닫으려면 파일 디스크립터를 전달인자로 사용하여 아래 함수 호출. 비동기 close() 함수의 경우 콜백 함수를 지정한다.
```sh
fs.close(fd, callback);
fs.closeSync(fd);
```
비/동기 모드로 파일을 열고 닫는 예제. err와 fb를 전달인자로 받는 콜백함수 지정. 그리고 fb는 파일을 읽고 쓰기 위해 사용하는 파일 디스크립터 지정.
```sh
//동기 모드
var fd = fs.openSync("myFile", 'w');
fs.closeSync();

//비동기모드
fs.open("myFile", 'w', function(err, fb){
    if(!err) {
        fs.close(fd);
    }
});
```
>비동기 모드와 동기 모드의 차이점은 비동기에서는 꼭 콜백함수를 지정하는 부분이 2개의 예제부분에 다르다는 것을 느꼈을 것이다. 

---
### 파일 쓰기
fs(File system) 모듈에서는 총 4가지의 방법을 제공한다.
- 단일 호출로 파일에 데이 쓰기
- 동기 쓰기를 사용해 chunk(덩어리) 단위로 쓰기
- 비동기 쓰기를 사용해 chunk(덩어리) 단위로 쓰기
- writable  스트림을 통한 스트림 쓰기

#### 간판한 파일쓰기
파일에 데이트를 쓰기 위한 가장 간편한 방법은 writeFile() 함수를 사용하여 쓰기이다.
```sh
//비동기 방식
fs.writeFile(path, data, [options], callback);
//동기 방식
fs.writeFileSync(path, data, [options]);
```
>path 전달인자를 통해 파일의 경로(절대/상대) 지정. data 전달인자를 통해 파일에 쓸 String이나 Buffer객제 지정. 선택적으로 사용하는 options 전달인자에는 문자열이나 encoding이나 파일을 열 때 사용할 mode, flag속성 전달. 비동기 함수의 경우 파일 쓰기 완료 후 수행될 콜백 함수를 전달해야한다.

>> //참고//  file_write.js :: 파일에 JSON 문자열 쓰기